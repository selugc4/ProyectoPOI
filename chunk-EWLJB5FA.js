import{a as Me,b as Pe}from"./chunk-AQEQ7WKT.js";import"./chunk-6S6VJZAU.js";import"./chunk-V5GFJSPU.js";import"./chunk-BAYGAGNG.js";import"./chunk-WFFGWTLI.js";import"./chunk-HC6MZPB3.js";import"./chunk-U476NMHI.js";import"./chunk-YMI2B6JE.js";import"./chunk-ZQ7N7COZ.js";import"./chunk-FERD25SW.js";import"./chunk-37U7H7Y2.js";import"./chunk-SJBLRW5X.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-DQOEGNHS.js";import"./chunk-MCRJI3T3.js";import"./chunk-53KKORZ4.js";import"./chunk-6KTICKCM.js";import"./chunk-3WQXTENQ.js";import"./chunk-BZ2JL7UE.js";import{a as fe,l as Ce,m as ye,n as ve}from"./chunk-2LRE465P.js";import{a as be}from"./chunk-UBXYT4VF.js";import{a as Le}from"./chunk-OMEQORPI.js";import{$ as u,Ab as we,Ba as X,C as L,D as b,E as R,Ea as Y,F,Fb as he,G as d,Gb as xe,H as a,I as r,J as M,Ja as Z,N as h,O as C,P as l,Pa as $,Qa as ee,W as B,X as _,Y as P,Z as N,aa as p,ba as w,da as S,e as W,ea as q,fa as z,ga as T,ha as A,hb as te,i as f,ib as ie,ja as j,jb as ne,ka as U,kb as oe,l as g,lb as re,m,ma as H,mb as ae,na as G,nb as le,pb as ce,qb as se,rb as de,s as O,sb as _e,t as c,ta as J,tb as ge,ua as K,ub as me,vb as ue,w as k,wa as Q,z as v,zb as pe}from"./chunk-M5FVIQMQ.js";import"./chunk-UDHHHPKJ.js";import"./chunk-JSQDAY7T.js";import"./chunk-PAAW3VWM.js";import"./chunk-VU72VQEI.js";import"./chunk-BU6F7OWR.js";import"./chunk-JZYWOUJL.js";import"./chunk-WHJRDKSF.js";import"./chunk-4U6PRYVA.js";import"./chunk-LB2OG3QI.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g as y}from"./chunk-OLRFWS6T.js";var Se=()=>[1,2,3,4,5],Te=()=>[],Ee=(o,s)=>s._id;function Ve(o,s){if(o&1){let t=h();a(0,"ion-button",25),C("click",function(){g(t);let e=l(3);return m(e.saveLocation())}),_(1," Guardar "),r()}if(o&2){let t=l(3);d("disabled",!t.isValid())}}function De(o,s){if(o&1){let t=h();a(0,"ion-button",22),C("click",function(){g(t);let e=l(2);return m(e.toggleEditing())}),_(1),r(),v(2,Ve,2,1,"ion-button",23),a(3,"ion-button",24),C("click",function(){g(t);let e=l(2);return m(e.deleteLocation())}),_(4," Eliminar "),r()}if(o&2){let t=l(2);c(),N(" ",t.editing?"Cancelar":"Editar"," "),c(),d("ngIf",t.editing)}}function Ie(o,s){if(o&1){let t=h();a(0,"ion-item")(1,"ion-label",8),_(2,"Imagen URL *"),r(),a(3,"ion-input",26),w("ngModelChange",function(e){g(t);let n=l(2);return p(n.location.image,e)||(n.location.image=e),m(e)}),r()()}if(o&2){let t=l(2);c(3),d("readonly",!t.editing),u("ngModel",t.location.image)}}function We(o,s){if(o&1){let t=h();a(0,"ion-input",27),w("ngModelChange",function(e){g(t);let n=l(2);return p(n.review.author,e)||(n.review.author=e),m(e)}),r()}if(o&2){let t=l(2);u("ngModel",t.review.author)}}function Oe(o,s){if(o&1){let t=h();a(0,"ion-input",27),w("ngModelChange",function(e){g(t);let n=l(2);return p(n.reviewLog.author,e)||(n.reviewLog.author=e),m(e)}),r()}if(o&2){let t=l(2);u("ngModel",t.reviewLog.author)}}function ke(o,s){if(o&1){let t=h();a(0,"ion-button",29),C("click",function(){let e=g(t).$implicit,n=l(3);return m(n.review.rating=e)}),M(1,"ion-icon",30),r()}if(o&2){let t=s.$implicit,i=l(3);c(),d("name",t<=i.review.rating?"star":"star-outline")}}function Re(o,s){o&1&&v(0,ke,2,1,"ion-button",28),o&2&&d("ngForOf",S(1,Se))}function Fe(o,s){if(o&1){let t=h();a(0,"ion-button",29),C("click",function(){let e=g(t).$implicit,n=l(3);return m(n.reviewLog.rating=e)}),M(1,"ion-icon",30),r()}if(o&2){let t=s.$implicit,i=l(3);c(),d("name",t<=i.reviewLog.rating?"star":"star-outline")}}function Be(o,s){o&1&&v(0,Fe,2,1,"ion-button",28),o&2&&d("ngForOf",S(1,Se))}function Ne(o,s){if(o&1){let t=h();a(0,"ion-textarea",31),w("ngModelChange",function(e){g(t);let n=l(2);return p(n.review.reviewText,e)||(n.review.reviewText=e),m(e)}),r()}if(o&2){let t=l(2);u("ngModel",t.review.reviewText)}}function qe(o,s){if(o&1){let t=h();a(0,"ion-textarea",31),w("ngModelChange",function(e){g(t);let n=l(2);return p(n.reviewLog.reviewText,e)||(n.reviewLog.reviewText=e),m(e)}),r()}if(o&2){let t=l(2);u("ngModel",t.reviewLog.reviewText)}}function ze(o,s){o&1&&M(0,"ion-icon",37)}function Ae(o,s){if(o&1){let t=h();a(0,"ion-col",35)(1,"ion-button",29),C("click",function(){g(t);let e=l().$implicit,n=l(3);return m(n.deleteReview(e._id))}),M(2,"ion-icon",38),r()()}}function je(o,s){if(o&1&&(a(0,"ion-card",13)(1,"ion-card-header")(2,"ion-row",14)(3,"ion-col")(4,"h2",32),_(5),r(),a(6,"p",33),_(7),q(8,"date"),r()(),a(9,"ion-col",16),v(10,ze,1,0,"ion-icon",34),r(),L(11,Ae,3,0,"ion-col",35),r()(),a(12,"ion-card-content")(13,"p",36),_(14),r()()()),o&2){let t=s.$implicit,i=l(3);c(5),P(t.author),c(2),P(z(8,5,t.createdOn,"longDate")),c(3),d("ngForOf",S(8,Te).constructor(t.rating)),c(),b(i.logged?11:-1),c(3),P(t.reviewText)}}function Ue(o,s){if(o&1&&(a(0,"ion-list")(1,"ion-list-header")(2,"ion-title")(3,"strong"),_(4,"Comentarios"),r()()(),R(5,je,15,9,"ion-card",13,Ee),r()),o&2){let t=l(2);c(5),F(t.location.reviews)}}function He(o,s){o&1&&(a(0,"h1",4)(1,"strong"),_(2,"No hay comentarios disponibles"),r()())}function Ge(o,s){if(o&1){let t=h();a(0,"ion-content",5)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),_(4,"Detalles de la ubicaci\xF3n"),r(),L(5,De,5,2),r(),a(6,"ion-card-content")(7,"div",6),M(8,"img",7)(9,"img"),r(),a(10,"ion-item")(11,"ion-label",8),_(12,"Nombre *"),r(),a(13,"ion-input",9),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.name,e)||(n.location.name=e),m(e)}),r()(),a(14,"ion-item")(15,"ion-label",8),_(16,"Direcci\xF3n"),r(),a(17,"ion-input",10),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.address,e)||(n.location.address=e),m(e)}),r()(),a(18,"ion-item")(19,"ion-label",8),_(20,"Localidad *"),r(),a(21,"ion-input",9),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.locality,e)||(n.location.locality=e),m(e)}),r()(),a(22,"ion-item")(23,"ion-label",8),_(24,"Regi\xF3n *"),r(),a(25,"ion-input",9),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.region,e)||(n.location.region=e),m(e)}),r()(),a(26,"ion-item")(27,"ion-label",8),_(28,"Pa\xEDs *"),r(),a(29,"ion-input",9),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.country,e)||(n.location.country=e),m(e)}),r()(),a(30,"ion-item")(31,"ion-label",8),_(32,"Coordenadas (lng, lat) *"),r(),a(33,"ion-input",11),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.locationCoords.coordinates[0],e)||(n.location.locationCoords.coordinates[0]=e),m(e)}),r(),a(34,"ion-input",12),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.locationCoords.coordinates[1],e)||(n.location.locationCoords.coordinates[1]=e),m(e)}),r()(),a(35,"ion-item")(36,"ion-label",8),_(37,"Coordenadas propias (lng, lat) *"),r(),a(38,"ion-input",11),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.ownCoords.coordinates[0],e)||(n.location.ownCoords.coordinates[0]=e),m(e)}),r(),a(39,"ion-input",12),w("ngModelChange",function(e){g(t);let n=l();return p(n.location.ownCoords.coordinates[1],e)||(n.location.ownCoords.coordinates[1]=e),m(e)}),r()(),L(40,Ie,4,2,"ion-item"),r()(),a(41,"ion-card",13)(42,"ion-card-header")(43,"ion-row",14)(44,"ion-title"),_(45,"\xA1Agrega un nuevo comentario al POI!"),r()(),a(46,"ion-row",14)(47,"ion-col"),L(48,We,1,1,"ion-input",15)(49,Oe,1,1,"ion-input",15),r(),a(50,"ion-col",16),L(51,Re,1,2,"ion-button",17)(52,Be,1,2,"ion-button",17),r()()(),a(53,"ion-card-content"),L(54,Ne,1,1,"ion-textarea",18)(55,qe,1,1,"ion-textarea",18),a(56,"ion-button",19),C("click",function(){g(t);let e=l();return m(e.submitReview())}),_(57,"Comentar"),r()()(),v(58,Ue,7,0,"ion-list",20)(59,He,3,0,"h1",21),r()}if(o&2){let t=l();c(5),b(t.logged?5:-1),c(3),d("src",t.location.image||"assets/LocationDefault.png",O),c(5),d("readonly",!t.editing),u("ngModel",t.location.name),c(4),d("readonly",!t.editing),u("ngModel",t.location.address),c(4),d("readonly",!t.editing),u("ngModel",t.location.locality),c(4),d("readonly",!t.editing),u("ngModel",t.location.region),c(4),d("readonly",!t.editing),u("ngModel",t.location.country),c(4),d("readonly",!t.editing),u("ngModel",t.location.locationCoords.coordinates[0]),c(),d("readonly",!t.editing),u("ngModel",t.location.locationCoords.coordinates[1]),c(4),d("readonly",!t.editing),u("ngModel",t.location.ownCoords.coordinates[0]),c(),d("readonly",!t.editing),u("ngModel",t.location.ownCoords.coordinates[1]),c(),b(t.editing?40:-1),c(8),b(t.logged?49:48),c(3),b(t.logged?52:51),c(3),b(t.logged?55:54),c(4),d("ngIf",t.location==null||t.location.reviews==null?null:t.location.reviews.length),c(),d("ngIf",t.location&&!(t.location.reviews!=null&&t.location.reviews.length))}}function Je(o,s){o&1&&(M(0,"ion-spinner",39),a(1,"p",4),_(2," Cargando..."),r())}function Ke(o,s){if(o&1&&(a(0,"p",40),_(1),r()),o&2){let t=l();c(),P(t.errorMessage||"Ubicaci\xF3n no encontrada.")}}var gt=(()=>{let s=class s{constructor(){this.locationId="",this.changeDetectorRef=f(A),this.router=f(Q),this.toastController=f(Me),this.logged=!1,this.editing=!1,this.location={_id:"",name:"",address:"",locality:"",region:"",country:"",fsq_id:"",image:"",locationCoords:{coordinates:[]},ownCoords:{coordinates:[]},date:"",reviews:[]},this.review={author:"",rating:0,reviewText:""},this.reviewLog={author:"",rating:0,Ownlng:0,Ownlat:0,reviewText:""},this.loading=!0,this.errorMessage="",this.route=f(K),this.locationsService=f(be),this.authService=f(Le),this.photoService=f(Pe),fe({star:Ce,starOutline:ye,trash:ve})}ngOnInit(){this.router.events.pipe(W(i=>i instanceof J)).subscribe(i=>{i.url.startsWith("/location-detail")||this.resetReviewForm()}),this.authService.user$.subscribe(i=>{this.logged=!!i}),this.locationId=this.route.snapshot.paramMap.get("id"),this.fetchLocation()}get locationCoordsString(){var i,e,n,x;return(x=(n=(e=(i=this.location)==null?void 0:i.locationCoords)==null?void 0:e.coordinates)==null?void 0:n.join(", "))!=null?x:"No disponible"}get ownCoordsString(){var i,e,n,x;return(x=(n=(e=(i=this.location)==null?void 0:i.ownCoords)==null?void 0:e.coordinates)==null?void 0:n.join(", "))!=null?x:"No disponible"}fetchLocation(){this.locationsService.getLocationById(this.locationId).subscribe({next:i=>{this.location=i,this.loading=!1},error:i=>{this.errorMessage="Error cargando la ubicaci\xF3n: "+i.message,this.loading=!1}})}submitReview(){return y(this,null,function*(){var i;if(!this.logged&&(!this.review.author||!this.review.reviewText||this.review.rating<=0)){this.showToast("Por favor, completa todos los campos del comentario","warning");return}else if(this.logged&&(!this.reviewLog.author||!this.reviewLog.reviewText||this.reviewLog.rating<=0||!((i=this.location.ownCoords)!=null&&i.coordinates))){this.showToast("Por favor, completa todos los campos del comentario","warning");return}this.logged?(yield this.getLocation(),this.locationsService.addReviewLogged(this.locationId,this.reviewLog).subscribe({next:e=>{console.log("Review insertada:",e),this.showToast("Comentario enviado con \xE9xito"),this.resetReviewForm(),this.fetchLocation()},error:e=>{console.error("Error al insertar review:",e),this.showToast("Error al enviar comentario","danger")}})):this.locationsService.addReview(this.locationId,this.review).subscribe({next:e=>{console.log("Review insertada:",e),this.showToast("Comentario enviado con \xE9xito"),this.resetReviewForm(),this.fetchLocation()},error:e=>{console.error("Error al insertar review:",e),this.showToast("Error al enviar comentario","danger")}})})}getLocation(){return y(this,null,function*(){let i=yield this.photoService.getLocation();i&&(this.reviewLog.Ownlat=i.coords.latitude,this.reviewLog.Ownlng=i.coords.longitude)})}resetReviewForm(){console.log("Reseteando formulario"),this.review.author="",this.review.reviewText="",this.review.rating=0,this.reviewLog.author="",this.reviewLog.reviewText="",this.reviewLog.rating=0,this.changeDetectorRef.detectChanges()}showToast(i,e="success"){return y(this,null,function*(){yield(yield this.toastController.create({message:i,duration:2e3,position:"bottom",color:e})).present()})}deleteReview(i){return y(this,null,function*(){try{let e=yield this.locationsService.deleteReview(this.locationId,i);console.log("Review eliminada:",e),this.showToast("Comentario eliminado con \xE9xito"),this.fetchLocation()}catch(e){console.error("Error al eliminar review:",e),this.showToast("Error al eliminar comentario","danger")}})}toggleEditing(){this.editing=!this.editing,this.editing||this.fetchLocation()}isValid(){var x,E,V,D,I;let i=this.location;if(!((x=i.name)!=null&&x.trim())||!((E=i.locality)!=null&&E.trim())||!((V=i.region)!=null&&V.trim())||!((D=i.country)!=null&&D.trim())||!((I=i.image)!=null&&I.trim()))return!1;let e=i.locationCoords.coordinates;if(!this.isValidCoord(e))return!1;let n=i.ownCoords.coordinates;return!!this.isValidCoord(n)}isValidCoord(i){if(!Array.isArray(i)||i.length!==2)return!1;let[e,n]=i;return!(typeof e!="number"||typeof n!="number"||e<-180||e>180||n<-90||n>90)}saveLocation(){return y(this,null,function*(){let i={name:this.location.name,address:this.location.address,locality:this.location.locality,region:this.location.region,country:this.location.country,fsq_id:this.location.fsq_id,image:this.location.image,Otherlat:this.location.ownCoords.coordinates[1],Otherlng:this.location.ownCoords.coordinates[0],Ownlat:this.location.ownCoords.coordinates[1],Ownlng:this.location.ownCoords.coordinates[0],date:this.location.date,reviews:this.location.reviews};if(!this.isValid()){this.showToast("Por favor completa todos los campos correctamente","warning");return}try{console.log("Guardando ubicaci\xF3n:",i),yield this.locationsService.updateLocation(i,this.location._id),this.showToast("Ubicaci\xF3n guardada con \xE9xito"),this.editing=!1,this.fetchLocation()}catch(e){this.showToast("Error al guardar la ubicaci\xF3n","danger"),console.error(e)}})}deleteLocation(){return y(this,null,function*(){try{yield this.locationsService.deleteLocation(this.locationId),this.showToast("Ubicaci\xF3n eliminada con \xE9xito"),this.router.navigate([""])}catch(i){console.error("Error al eliminar ubicaci\xF3n:",i),this.showToast("Error al eliminar ubicaci\xF3n","danger")}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["app-location-detail"]],decls:9,vars:3,consts:[["loadingTpl",""],["errorTpl",""],[3,"translucent"],["fullscreen","",4,"ngIf","ngIfElse"],[1,"centered-template"],["fullscreen",""],[1,"image-wrapper"],[1,"location-image",3,"src"],["position","stacked"],["required","",3,"ngModelChange","readonly","ngModel"],[3,"ngModelChange","readonly","ngModel"],["type","number","placeholder","Longitud","required","",3,"ngModelChange","readonly","ngModel"],["type","number","placeholder","Latitud","required","",3,"ngModelChange","readonly","ngModel"],[1,"review-card"],[1,"review-header"],["placeholder","Nombre del autor","ngDefaultControl","",1,"review-author-input",3,"ngModel"],["size","auto",1,"review-rating"],["fill","clear"],["placeholder","Escribe tu comentario","ngDefaultControl","",1,"review-text-input",3,"ngModel"],[1,"centered-button",3,"click"],[4,"ngIf"],["class","centered-template",4,"ngIf"],[3,"click"],[3,"disabled","click",4,"ngIf"],["color","danger",3,"click"],[3,"click","disabled"],["required","","type","url",3,"ngModelChange","readonly","ngModel"],["placeholder","Nombre del autor","ngDefaultControl","",1,"review-author-input",3,"ngModelChange","ngModel"],["fill","clear",3,"click",4,"ngFor","ngForOf"],["fill","clear",3,"click"],[3,"name"],["placeholder","Escribe tu comentario","ngDefaultControl","",1,"review-text-input",3,"ngModelChange","ngModel"],[1,"review-author"],[1,"review-date"],["name","star",4,"ngFor","ngForOf"],["size","auto",1,"review-trash"],[1,"review-text"],["name","star"],["slot","icon-only","name","trash"],["name","crescent"],["color","danger"]],template:function(e,n){if(e&1&&(a(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-title"),_(3,"location-detail"),r()()(),v(4,Ge,60,26,"ion-content",3)(5,Je,3,0,"ng-template",null,0,T)(7,Ke,2,1,"ng-template",4,1,T)),e&2){let x=B(6);d("translucent",!0),c(4),d("ngIf",!n.loading)("ngIfElse",x)}},dependencies:[le,ce,pe,we,G,j,U,H,ee,X,Y,$,Z,ie,oe,re,ne,_e,ge,ue,ae,he,me,te,se,de,xe],styles:[".search-container[_ngcontent-%COMP%]{text-align:center;max-width:800px;margin:2rem auto;padding:1.5rem 2rem;background:#d0e7ff;border-radius:12px;box-shadow:0 4px 8px #0000001a;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}.review-card[_ngcontent-%COMP%]{max-width:80%;margin:16px auto;border-radius:12px;box-shadow:0 2px 10px #0000001a}.review-header[_ngcontent-%COMP%]{align-items:center}.review-author[_ngcontent-%COMP%]{margin:0;font-weight:700;color:#1565c0}.review-date[_ngcontent-%COMP%]{margin:0;font-size:.85rem;color:#666;font-style:italic}.review-trash[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;--border-width: 0}.review-rating[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fbc02d;font-size:1.2rem;margin-left:2px}.review-trash[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:red;font-size:3rem;margin-left:20px}.review-text[_ngcontent-%COMP%]{font-size:1rem;color:#333;margin-top:8px}ion-list[_ngcontent-%COMP%]{background-color:transparent}.centered-template[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:1rem}.centered-button[_ngcontent-%COMP%]{display:block;margin:0 auto;width:auto!important;max-width:20%}.image-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:1rem}ion-item[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;--border-width: 0}.location-image[_ngcontent-%COMP%]{max-width:200px;height:auto}"]});let o=s;return o})();export{gt as LocationDetailPage};

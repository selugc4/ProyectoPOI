import{a as re}from"./chunk-HA63HTGI.js";import{a as ae}from"./chunk-UYLNLCYZ.js";import{$ as b,Aa as W,Da as B,E as N,Ea as A,F as T,G as m,Ga as G,H as e,I as t,Ia as U,J as F,Ja as j,N as P,O as h,P as g,Pa as q,X as l,Y as p,Z as I,_ as S,aa as y,gb as H,hb as R,i as M,ia as V,ja as z,kb as J,l as _,lb as K,m as f,ma as D,mb as Q,nb as X,ob as Y,pb as Z,qb as $,rb as ee,s as L,t as a,tb as te,w as k,xb as ie,yb as ne,z as x,zb as oe}from"./chunk-BWDMBPI3.js";import"./chunk-UDHHHPKJ.js";import"./chunk-JSQDAY7T.js";import"./chunk-PAAW3VWM.js";import"./chunk-VU72VQEI.js";import"./chunk-BU6F7OWR.js";import"./chunk-JZYWOUJL.js";import"./chunk-WHJRDKSF.js";import"./chunk-4U6PRYVA.js";import"./chunk-LB2OG3QI.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as w,b as E,g as C}from"./chunk-OLRFWS6T.js";var le=(n,d)=>d.fsq_id;function de(n,d){if(n&1&&(e(0,"ion-text",14),l(1),t()),n&2){let o=g();a(),I(" ",o.errorMessage," ")}}function ce(n,d){if(n&1){let o=P();e(0,"ion-card",16)(1,"ion-row")(2,"ion-col",17),F(3,"img",18)(4,"img"),t(),e(5,"ion-col",19)(6,"ion-card-title"),l(7),t(),e(8,"p",20),l(9),t(),e(10,"p",21),l(11),t(),e(12,"p",22),l(13),t()()(),e(14,"ion-row")(15,"ion-col",23)(16,"ion-button",24),h("click",function(){let s=_(o).$implicit,i=g(2);return f(i.addPoi(s))}),l(17,"A\xF1adir"),t()()()()}if(n&2){let o=d.$implicit;a(3),m("src",o.image||"assets/LocationDefault.png",L),a(4),p(o.name),a(2),p(o.address||"Direcci\xF3n no disponible"),a(2),p(o.locality),a(2),p(o.country)}}function me(n,d){if(n&1&&(e(0,"ion-list",15),N(1,ce,18,5,"ion-card",16,le),t()),n&2){let o=g();a(),T(o.results)}}function ge(n,d){if(n&1){let o=P();e(0,"ion-item",25)(1,"ion-label")(2,"h3"),l(3),t(),e(4,"p"),l(5),t()(),e(6,"ion-button",27),h("click",function(){let s=_(o).index,i=g(2);return f(i.removePoi(s))}),l(7,"Eliminar"),t()()}if(n&2){let o=d.$implicit;a(3),p(o.name),a(2),p(o.address||"Direcci\xF3n no disponible")}}function pe(n,d){if(n&1&&(e(0,"ion-list",25),x(1,ge,8,2,"ion-item",26),t()),n&2){let o=g();a(),m("ngForOf",o.addedPois)}}function ue(n,d){n&1&&(e(0,"p"),l(1,"No hay POIs a\xF1adidos a\xFAn."),t())}function he(n,d){if(n&1){let o=P();e(0,"div",28)(1,"ion-button",29),h("click",function(){_(o);let s=g();return f(s.guardarPois())}),l(2),t()()}if(n&2){let o=g();a(),m("disabled",o.addedPois.length===0||o.saving),a(),I(" ",o.saving?"Guardando...":"Guardar todos"," ")}}var ve=(()=>{let d=class d{constructor(){this.searchName="",this.searchLat=null,this.searchLng=null,this.results=[],this.locationService=M(re),this.loading=!1,this.errorMessage="",this.addedPois=[],this.saving=!1,this.authService=M(ae)}ngOnInit(){}addPoi(r){this.addedPois.some(s=>s.fsq_id===r.fsq_id)||this.addedPois.push(r)}removePoi(r){this.addedPois.splice(r,1)}onSearch(){return C(this,null,function*(){var c,v,O;this.errorMessage="",this.results=[];let r=(c=this.searchLat)!=null?c:void 0,s=(v=this.searchLng)!=null?v:void 0,i=!!((O=this.searchName)!=null&&O.trim()),u=r!==void 0&&s!==void 0;if(u&&(r<-90||r>90||s<-180||s>180)){this.errorMessage="Las coordenadas no son v\xE1lidas.";return}if(!i&&!u){this.errorMessage="Por favor, introduce un nombre o coordenadas v\xE1lidas para buscar.";return}this.loading=!0;try{this.results=yield this.locationService.getApiPOIs(this.searchName||"",r,s),this.results.length===0&&(this.errorMessage="No se encontraron resultados para esos criterios.")}catch(se){this.errorMessage="Error al buscar ubicaciones.",console.error(se),this.results=[]}finally{this.loading=!1}})}guardarPois(){return C(this,null,function*(){this.saving=!0;try{let r=yield this.authService.getCurrentUser();if(!r||!r.uid)throw new Error("Usuario no autenticado");let s=this.addedPois.map(i=>E(w({},i),{createdBy:r.uid}));console.log(s),yield this.locationService.insertMany(s),this.resetFormulario()}catch(r){console.error("Error al guardar POIs:",r),this.errorMessage="Error al guardar los POIs."}finally{this.saving=!1}})}resetFormulario(){this.searchName="",this.searchLat=null,this.searchLng=null,this.results=[],this.addedPois=[],this.errorMessage=""}};d.\u0275fac=function(s){return new(s||d)},d.\u0275cmp=k({type:d,selectors:[["app-search-pois"]],decls:32,vars:10,consts:[[1,"ion-padding"],["size","6"],[1,"search-container",3,"submit"],["position","stacked"],["type","text","ngDefaultControl","","name","searchName",3,"ngModelChange","ngModel"],["type","number","ngDefaultControl","","name","searchLat","step","any",3,"ngModelChange","ngModel"],["type","number","ngDefaultControl","","name","searchLng","step","any",3,"ngModelChange","ngModel"],["expand","block","type","submit",3,"disabled"],["color","danger","class","ion-margin-top",4,"ngIf"],["class","results-list",4,"ngIf"],["size","6",1,"added-pois-list"],["class","added-pois-item",4,"ngIf"],[4,"ngIf"],["class","ion-text-center ion-margin-top",4,"ngIf"],["color","danger",1,"ion-margin-top"],[1,"results-list"],[1,"location-card"],["size","5"],[1,"location-image",3,"src"],["size","7",1,"location-details"],[1,"address"],[1,"locality"],[1,"country"],["size","12",1,"ion-text-right"],["size","small",3,"click"],[1,"added-pois-item"],["class","added-pois-item",4,"ngFor","ngForOf"],["color","danger","size","small","slot","end",3,"click"],[1,"ion-text-center","ion-margin-top"],["expand","block","color","primary",3,"click","disabled"]],template:function(s,i){s&1&&(e(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),l(3,"Buscador de ubicaciones"),t()()(),e(4,"ion-content",0)(5,"ion-grid")(6,"ion-row")(7,"ion-col",1)(8,"form",2),h("submit",function(c){return i.onSearch(),c.preventDefault()}),e(9,"ion-item")(10,"ion-label",3),l(11,"Nombre"),t(),e(12,"ion-input",4),y("ngModelChange",function(c){return b(i.searchName,c)||(i.searchName=c),c}),t()(),e(13,"ion-item")(14,"ion-label",3),l(15,"Latitud"),t(),e(16,"ion-input",5),y("ngModelChange",function(c){return b(i.searchLat,c)||(i.searchLat=c),c}),t()(),e(17,"ion-item")(18,"ion-label",3),l(19,"Longitud"),t(),e(20,"ion-input",6),y("ngModelChange",function(c){return b(i.searchLng,c)||(i.searchLng=c),c}),t()(),e(21,"ion-button",7),l(22),t()(),x(23,de,2,1,"ion-text",8)(24,me,3,0,"ion-list",9),t(),e(25,"ion-col",10)(26,"h2"),l(27,"POIs a\xF1adidos"),t(),e(28,"div"),x(29,pe,2,1,"ion-list",11)(30,ue,2,0,"p",12)(31,he,3,2,"div",13),t()()()()()),s&2&&(a(12),S("ngModel",i.searchName),a(4),S("ngModel",i.searchLat),a(4),S("ngModel",i.searchLng),a(),m("disabled",i.loading),a(),I(" ",i.loading?"Buscando...":"Buscar"," "),a(),m("ngIf",i.errorMessage),a(),m("ngIf",i.results.length>0),a(5),m("ngIf",i.addedPois.length>0),a(),m("ngIf",i.addedPois.length===0),a(),m("ngIf",i.addedPois.length!==0))},dependencies:[Q,Y,ne,oe,D,V,z,q,j,W,B,A,U,G,Z,$,H,ie,ee,X,K,R,te,J],styles:[".location-image[_ngcontent-%COMP%]{height:120px;object-fit:cover;border-radius:10px}.location-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:10px;height:100%}.location-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding-left:5px}.location-details[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:4px;font-weight:700;color:#023e8a}.address[_ngcontent-%COMP%], .locality[_ngcontent-%COMP%], .country[_ngcontent-%COMP%]{font-size:.85rem;margin:1px 0;color:#555}.search-container[_ngcontent-%COMP%]{text-align:center;max-width:800px;margin:2rem auto;padding:1.5rem 2rem;background:#d0e7ff;border-radius:12px;box-shadow:0 4px 8px #0000001a;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}.results-list[_ngcontent-%COMP%]{background:#d0e7ff}.search-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent}.added-pois-item[_ngcontent-%COMP%]{--background: transparent;background:transparent!important}.added-pois-list[_ngcontent-%COMP%]{text-align:center;background:#d0e7ff}"]});let n=d;return n})();export{ve as SearchPOIsPage};

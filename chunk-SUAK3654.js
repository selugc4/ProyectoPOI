import{a as ie,b as te}from"./chunk-AQEQ7WKT.js";import"./chunk-6S6VJZAU.js";import"./chunk-V5GFJSPU.js";import"./chunk-BAYGAGNG.js";import"./chunk-WFFGWTLI.js";import"./chunk-HC6MZPB3.js";import"./chunk-U476NMHI.js";import"./chunk-YMI2B6JE.js";import"./chunk-ZQ7N7COZ.js";import"./chunk-FERD25SW.js";import"./chunk-37U7H7Y2.js";import"./chunk-SJBLRW5X.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-DQOEGNHS.js";import"./chunk-MCRJI3T3.js";import"./chunk-53KKORZ4.js";import"./chunk-6KTICKCM.js";import"./chunk-3WQXTENQ.js";import"./chunk-BZ2JL7UE.js";import{a as ee}from"./chunk-UBXYT4VF.js";import{a as $}from"./chunk-OMEQORPI.js";import{$ as h,Ab as Z,Ba as N,Ea as U,Fa as q,G as u,H as t,Ha as G,I as o,Ja as R,Ka as j,N as V,O as S,P as b,Pa as A,Qa as z,X as d,Z as L,aa as f,ba as w,hb as H,i as P,ka as D,l,m,na as B,nb as J,pb as K,qb as Q,rb as X,s as x,t as a,w as O,z as I,zb as Y}from"./chunk-M5FVIQMQ.js";import"./chunk-UDHHHPKJ.js";import"./chunk-JSQDAY7T.js";import"./chunk-PAAW3VWM.js";import"./chunk-VU72VQEI.js";import"./chunk-BU6F7OWR.js";import"./chunk-JZYWOUJL.js";import"./chunk-WHJRDKSF.js";import"./chunk-4U6PRYVA.js";import"./chunk-LB2OG3QI.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g as C}from"./chunk-OLRFWS6T.js";function ne(c,_){if(c&1){let p=V();t(0,"ion-button",15),S("click",function(){l(p);let n=b(2);return m(n.clearImage())}),d(1,"Eliminar imagen"),o()}}function ae(c,_){if(c&1&&(t(0,"ion-item"),I(1,ne,2,0,"ion-button",14),o()),c&2){let p=b();a(),u("ngIf",p.location.image)}}function re(c,_){if(c&1){let p=V();t(0,"ion-item")(1,"img",16),S("load",function(){l(p);let n=b();return m(n.onImageLoad())})("error",function(){l(p);let n=b();return m(n.onImageError())}),o()()}if(c&2){let p=b();a(),u("src",p.location.image,x)}}var ye=(()=>{let _=class _{constructor(){this.location={},this.loading=!1,this.imageSource="",this.imageValid=!0,this.locationService=P(ee),this.authService=P($),this.toastController=P(ie),this.photoService=P(te)}ngOnInit(){}onSubmit(){return C(this,null,function*(){var r,n,e,s,g,i,F,E,T,v,W,k;this.loading=!0;try{let M=yield this.authService.getCurrentUser(),y=yield this.getCurrentPosition(),oe={name:(r=this.location.name)!=null?r:"",address:(n=this.location.address)!=null?n:"",locality:(e=this.location.locality)!=null?e:"",region:(s=this.location.region)!=null?s:"",country:(g=this.location.country)!=null?g:"",fsq_id:(i=this.location.fsq_id)!=null?i:"",Otherlng:(F=this.location.Otherlng)!=null?F:0,Otherlat:(E=this.location.Otherlat)!=null?E:0,Ownlng:(T=y==null?void 0:y.coords.longitude)!=null?T:0,Ownlat:(v=y==null?void 0:y.coords.latitude)!=null?v:0,image:(W=this.location.image)!=null?W:"",createdBy:(k=M==null?void 0:M.uid)!=null?k:""};yield this.locationService.insert(oe),this.showToast("POI insertado correctamente","success"),this.resetForm()}catch(M){console.error(M),this.showToast("Error al insertar el POI","danger")}finally{this.loading=!1}})}onImageLoad(){this.imageValid=!0}onImageError(){this.location.image!=""&&(this.imageValid=!1)}getCurrentPosition(){return C(this,null,function*(){try{return yield new Promise((r,n)=>navigator.geolocation.getCurrentPosition(r,n))}catch{return null}})}resetForm(){this.location={}}showToast(r,n){return C(this,null,function*(){(yield this.toastController.create({message:r,duration:2e3,color:n,position:"bottom"})).present()})}onImageUrlChange(){return C(this,null,function*(){this.imageSource="url"})}onUploadPhoto(){return C(this,null,function*(){let r=yield this.photoService.takePicture();r&&(this.location.image=r,this.imageSource="camera")})}clearImage(){this.location.image="",this.imageSource="none"}};_.\u0275fac=function(n){return new(n||_)},_.\u0275cmp=O({type:_,selectors:[["app-formulario"]],decls:38,vars:14,consts:[["poiForm","ngForm"],[3,"translucent"],[3,"fullscreen"],[1,"search-container",3,"ngSubmit"],["position","stacked"],["required","","name","name","ngDefaultControl","",3,"ngModelChange","ngModel"],["name","address","ngDefaultControl","",3,"ngModelChange","ngModel"],["name","locality","ngDefaultControl","",3,"ngModelChange","ngModel"],["name","region","ngDefaultControl","",3,"ngModelChange","ngModel"],["name","country","ngDefaultControl","",3,"ngModelChange","ngModel"],["name","image","ngDefaultControl","",3,"ngModelChange","ionChange","ngModel","disabled"],[3,"click","disabled"],[4,"ngIf"],["expand","block","type","submit",3,"disabled"],["expand","block","fill","clear","color","danger",3,"click",4,"ngIf"],["expand","block","fill","clear","color","danger",3,"click"],[1,"preview-image",2,"max-width","100%","height","auto",3,"load","error","src"]],template:function(n,e){if(n&1){let s=V();t(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),d(3,"formulario"),o()()(),t(4,"ion-content",2)(5,"form",3,0),S("ngSubmit",function(){return l(s),m(e.onSubmit())}),t(7,"ion-item")(8,"ion-label",4),d(9,"Nombre"),o(),t(10,"ion-input",5),w("ngModelChange",function(i){return l(s),f(e.location.name,i)||(e.location.name=i),m(i)}),o()(),t(11,"ion-item")(12,"ion-label",4),d(13,"Direcci\xF3n"),o(),t(14,"ion-input",6),w("ngModelChange",function(i){return l(s),f(e.location.address,i)||(e.location.address=i),m(i)}),o()(),t(15,"ion-item")(16,"ion-label",4),d(17,"Localidad"),o(),t(18,"ion-input",7),w("ngModelChange",function(i){return l(s),f(e.location.locality,i)||(e.location.locality=i),m(i)}),o()(),t(19,"ion-item")(20,"ion-label",4),d(21,"Regi\xF3n"),o(),t(22,"ion-input",8),w("ngModelChange",function(i){return l(s),f(e.location.region,i)||(e.location.region=i),m(i)}),o()(),t(23,"ion-item")(24,"ion-label",4),d(25,"Pa\xEDs"),o(),t(26,"ion-input",9),w("ngModelChange",function(i){return l(s),f(e.location.country,i)||(e.location.country=i),m(i)}),o()(),t(27,"ion-item")(28,"ion-label",4),d(29,"Imagen (URL o Captura)"),o(),t(30,"ion-input",10),w("ngModelChange",function(i){return l(s),f(e.location.image,i)||(e.location.image=i),m(i)}),S("ionChange",function(){return l(s),m(e.onImageUrlChange())}),o()(),t(31,"ion-item")(32,"ion-button",11),S("click",function(){return l(s),m(e.onUploadPhoto())}),d(33,"Subir foto"),o()(),I(34,ae,2,1,"ion-item",12)(35,re,2,1,"ion-item",12),t(36,"ion-button",13),d(37),o()()()}n&2&&(u("translucent",!0),a(4),u("fullscreen",!0),a(6),h("ngModel",e.location.name),a(4),h("ngModel",e.location.address),a(4),h("ngModel",e.location.locality),a(4),h("ngModel",e.location.region),a(4),h("ngModel",e.location.country),a(4),h("ngModel",e.location.image),u("disabled",e.imageSource==="camera"),a(2),u("disabled",e.imageSource==="url"),a(2),u("ngIf",e.location.image),a(),u("ngIf",e.location.image),a(),u("disabled",e.loading||!e.location.name||!e.location.address||!e.location.locality||!e.location.region||!e.location.country||!e.imageValid),a(),L(" ",e.loading?"Guardando...":"Guardar POI"," "))},dependencies:[J,K,Y,Z,B,D,z,j,N,U,q,A,R,G,Q,X,H],styles:[".search-container[_ngcontent-%COMP%]{text-align:center;max-width:60%;margin:2rem auto;padding:1.5rem 2rem;background:#d0e7ff;border-radius:12px;box-shadow:0 4px 8px #0000001a;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}.search-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent}.preview-image[_ngcontent-%COMP%]{margin-top:10px;max-height:150px;max-width:100%;width:auto;object-fit:cover;border-radius:8px}"]});let c=_;return c})();export{ye as FormularioPage};

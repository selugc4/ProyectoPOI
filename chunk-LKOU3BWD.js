import{a as se,b as le}from"./chunk-C3SY4WTR.js";import"./chunk-6S6VJZAU.js";import"./chunk-V5GFJSPU.js";import"./chunk-BAYGAGNG.js";import"./chunk-WFFGWTLI.js";import"./chunk-HC6MZPB3.js";import"./chunk-U476NMHI.js";import"./chunk-YMI2B6JE.js";import"./chunk-ZQ7N7COZ.js";import"./chunk-FERD25SW.js";import"./chunk-37U7H7Y2.js";import"./chunk-SJBLRW5X.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-DQOEGNHS.js";import"./chunk-MCRJI3T3.js";import"./chunk-53KKORZ4.js";import"./chunk-6KTICKCM.js";import"./chunk-3WQXTENQ.js";import"./chunk-BZ2JL7UE.js";import{a as re}from"./chunk-GDGQMHKT.js";import{a as ae}from"./chunk-UYLNLCYZ.js";import{$ as v,Aa as W,Da as B,E as k,Ea as A,F as N,G as m,Ga as G,H as t,I as i,Ia as U,J as F,Ja as j,N as y,O as f,P as p,Pa as q,X as c,Y as u,Z as C,_ as b,aa as M,gb as H,hb as R,i as _,ia as V,ja as z,kb as J,l as x,lb as K,m as I,ma as D,mb as Q,nb as X,ob as Y,pb as Z,qb as $,rb as ee,s as L,t as s,tb as te,w as T,xb as ie,yb as ne,z as S,zb as oe}from"./chunk-BWDMBPI3.js";import"./chunk-UDHHHPKJ.js";import"./chunk-JSQDAY7T.js";import"./chunk-PAAW3VWM.js";import"./chunk-VU72VQEI.js";import"./chunk-BU6F7OWR.js";import"./chunk-JZYWOUJL.js";import"./chunk-WHJRDKSF.js";import"./chunk-4U6PRYVA.js";import"./chunk-LB2OG3QI.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as O,b as E,g as P}from"./chunk-OLRFWS6T.js";var de=(o,d)=>d.fsq_id;function me(o,d){if(o&1&&(t(0,"ion-text",14),c(1),i()),o&2){let a=p();s(),C(" ",a.errorMessage," ")}}function ge(o,d){if(o&1){let a=y();t(0,"ion-card",16)(1,"ion-row")(2,"ion-col",17),F(3,"img",18)(4,"img"),i(),t(5,"ion-col",19)(6,"ion-card-title"),c(7),i(),t(8,"p",20),c(9),i(),t(10,"p",21),c(11),i(),t(12,"p",22),c(13),i()()(),t(14,"ion-row")(15,"ion-col",23)(16,"ion-button",24),f("click",function(){let n=x(a).$implicit,e=p(2);return I(e.addPoi(n))}),c(17,"A\xF1adir"),i()()()()}if(o&2){let a=d.$implicit;s(3),m("src",a.image||"assets/LocationDefault.png",L),s(4),u(a.name),s(2),u(a.address||"Direcci\xF3n no disponible"),s(2),u(a.locality),s(2),u(a.country)}}function pe(o,d){if(o&1&&(t(0,"ion-list",15),k(1,ge,18,5,"ion-card",16,de),i()),o&2){let a=p();s(),N(a.results)}}function ue(o,d){if(o&1){let a=y();t(0,"ion-item",25)(1,"ion-label")(2,"h3"),c(3),i(),t(4,"p"),c(5),i()(),t(6,"ion-button",27),f("click",function(){let n=x(a).index,e=p(2);return I(e.removePoi(n))}),c(7,"Eliminar"),i()()}if(o&2){let a=d.$implicit;s(3),u(a.name),s(2),u(a.address||"Direcci\xF3n no disponible")}}function he(o,d){if(o&1&&(t(0,"ion-list",25),S(1,ue,8,2,"ion-item",26),i()),o&2){let a=p();s(),m("ngForOf",a.addedPois)}}function _e(o,d){o&1&&(t(0,"p"),c(1,"No hay POIs a\xF1adidos a\xFAn."),i())}function fe(o,d){if(o&1){let a=y();t(0,"div",28)(1,"ion-button",29),f("click",function(){x(a);let n=p();return I(n.guardarPois())}),c(2),i()()}if(o&2){let a=p();s(),m("disabled",a.addedPois.length===0||a.saving),s(),C(" ",a.saving?"Guardando...":"Guardar todos"," ")}}var Le=(()=>{let d=class d{constructor(){this.toastController=_(se),this.searchName="",this.searchLat=null,this.searchLng=null,this.results=[],this.locationService=_(re),this.loading=!1,this.errorMessage="",this.addedPois=[],this.saving=!1,this.authService=_(ae),this.photoService=_(le)}ngOnInit(){}addPoi(r){this.addedPois.some(n=>n.fsq_id===r.fsq_id)||this.addedPois.push(r)}removePoi(r){this.addedPois.splice(r,1)}onSearch(){return P(this,null,function*(){var l,h,w;this.errorMessage="",this.results=[];let r=(l=this.searchLat)!=null?l:void 0,n=(h=this.searchLng)!=null?h:void 0,e=!!((w=this.searchName)!=null&&w.trim()),g=r!==void 0&&n!==void 0;if(g&&(r<-90||r>90||n<-180||n>180)){this.errorMessage="Las coordenadas no son v\xE1lidas.";return}if(!e&&!g){this.errorMessage="Por favor, coordenadas v\xE1lidas para buscar y, si lo desea, un nombre.";return}this.loading=!0;try{this.results=yield this.locationService.getApiPOIs(this.searchName||"",r,n),this.results.length===0&&(this.errorMessage="No se encontraron resultados para esos criterios.")}catch(ce){this.errorMessage="Error al buscar ubicaciones.",console.error(ce),this.results=[]}finally{this.loading=!1}})}guardarPois(){return P(this,null,function*(){this.saving=!0;let r=yield this.photoService.getLocation();try{let n=yield this.authService.getCurrentUser();if(!n||!n.uid)throw new Error("Usuario no autenticado");let e=this.addedPois.map(g=>{var l,h;return E(O({},g),{Ownlat:(l=r==null?void 0:r.coords.latitude)!=null?l:0,Ownlng:(h=r==null?void 0:r.coords.longitude)!=null?h:0,createdBy:n.uid})});console.log(e),yield this.locationService.insertMany(e),this.resetFormulario(),yield this.showToast("POIs guardados correctamente.","success")}catch(n){console.error("Error al guardar POIs:",n),yield this.showToast("No se pudieron guardar los POIs.","danger")}finally{this.saving=!1}})}resetFormulario(){this.searchName="",this.searchLat=null,this.searchLng=null,this.results=[],this.addedPois=[],this.errorMessage=""}showToast(r,n){return P(this,null,function*(){(yield this.toastController.create({message:r,duration:3e3,position:"bottom",color:n})).present()})}};d.\u0275fac=function(n){return new(n||d)},d.\u0275cmp=T({type:d,selectors:[["app-search-pois"]],decls:32,vars:10,consts:[[1,"ion-padding"],["size","6"],[1,"search-container",3,"submit"],["position","stacked"],["type","text","ngDefaultControl","","name","searchName",1,"name",3,"ngModelChange","ngModel"],["type","number","ngDefaultControl","","name","searchLat","step","any",1,"lat",3,"ngModelChange","ngModel"],["type","number","ngDefaultControl","","name","searchLng","step","any",1,"lng",3,"ngModelChange","ngModel"],["expand","block","type","submit",3,"disabled"],["color","danger","class","ion-margin-top",4,"ngIf"],["class","results-list",4,"ngIf"],["size","6",1,"added-pois-list"],["class","added-pois-item",4,"ngIf"],[4,"ngIf"],["class","ion-text-center ion-margin-top",4,"ngIf"],["color","danger",1,"ion-margin-top"],[1,"results-list"],[1,"location-card"],["size","5"],[1,"location-image",3,"src"],["size","7",1,"location-details"],[1,"address"],[1,"locality"],[1,"country"],["size","12",1,"ion-text-right"],["size","small",3,"click"],[1,"added-pois-item"],["class","added-pois-item",4,"ngFor","ngForOf"],["color","danger","size","small","slot","end",3,"click"],[1,"ion-text-center","ion-margin-top"],["expand","block","color","primary",1,"guardado",3,"click","disabled"]],template:function(n,e){n&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),c(3,"Buscador de ubicaciones"),i()()(),t(4,"ion-content",0)(5,"ion-grid")(6,"ion-row")(7,"ion-col",1)(8,"form",2),f("submit",function(l){return e.onSearch(),l.preventDefault()}),t(9,"ion-item")(10,"ion-label",3),c(11,"Nombre"),i(),t(12,"ion-input",4),M("ngModelChange",function(l){return v(e.searchName,l)||(e.searchName=l),l}),i()(),t(13,"ion-item")(14,"ion-label",3),c(15,"Latitud"),i(),t(16,"ion-input",5),M("ngModelChange",function(l){return v(e.searchLat,l)||(e.searchLat=l),l}),i()(),t(17,"ion-item")(18,"ion-label",3),c(19,"Longitud"),i(),t(20,"ion-input",6),M("ngModelChange",function(l){return v(e.searchLng,l)||(e.searchLng=l),l}),i()(),t(21,"ion-button",7),c(22),i()(),S(23,me,2,1,"ion-text",8)(24,pe,3,0,"ion-list",9),i(),t(25,"ion-col",10)(26,"h2"),c(27,"POIs a\xF1adidos"),i(),t(28,"div"),S(29,he,2,1,"ion-list",11)(30,_e,2,0,"p",12)(31,fe,3,2,"div",13),i()()()()()),n&2&&(s(12),b("ngModel",e.searchName),s(4),b("ngModel",e.searchLat),s(4),b("ngModel",e.searchLng),s(),m("disabled",e.loading),s(),C(" ",e.loading?"Buscando...":"Buscar"," "),s(),m("ngIf",e.errorMessage),s(),m("ngIf",e.results.length>0),s(5),m("ngIf",e.addedPois.length>0),s(),m("ngIf",e.addedPois.length===0),s(),m("ngIf",e.addedPois.length!==0))},dependencies:[Q,Y,ne,oe,D,V,z,q,j,W,B,A,U,G,Z,$,H,ie,ee,X,K,R,te,J],styles:[".location-image[_ngcontent-%COMP%]{height:120px;object-fit:cover;border-radius:10px}.location-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:10px;height:100%}.location-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding-left:5px}.location-details[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:4px;font-weight:700;color:#023e8a}.address[_ngcontent-%COMP%], .locality[_ngcontent-%COMP%], .country[_ngcontent-%COMP%]{font-size:.85rem;margin:1px 0;color:#555}.search-container[_ngcontent-%COMP%]{text-align:center;max-width:60%;margin:2rem auto;padding:1.5rem 2rem;background:#d0e7ff;border-radius:12px;box-shadow:0 4px 8px #0000001a;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}.results-list[_ngcontent-%COMP%]{background:#d0e7ff}.search-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent}.added-pois-item[_ngcontent-%COMP%]{--background: transparent;background:transparent!important}.added-pois-list[_ngcontent-%COMP%]{text-align:center;background:#d0e7ff}"]});let o=d;return o})();export{Le as SearchPOIsPage};
